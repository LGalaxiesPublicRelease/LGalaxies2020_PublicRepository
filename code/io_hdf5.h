#include "allvars.h"
#include "proto.h"
#include "hdf5.h"
#include "hdf5_hl.h"
 
#define NRECORDS (hsize_t) 0
#define HDF5_STRING_SIZE 2048
 
/* File to set all the HDF5 table properties */ 
int ifield;
int rowsize=0;
hsize_t chunk_size=CHUNK_SIZE;
int * fill_data=NULL;
hid_t file_id;
size_t * output_offsets;
hid_t field_type;
hid_t * field_types;
size_t output_size;
size_t * output_sizes;
 
// Define the dimensions for the HDF5 table
// Should be as large as the number of possible array dimensions+1
hsize_t dims[6];
 
// The number of fields in the data
int nfields=113;
 
// The field names
const char * field_names[]={
"Type",
"HaloIndex",
"HaloM_Mean200",
"HaloM_Crit200",
"HaloM_TopHat",
"HaloPos",
"HaloVel",
"HaloVelDisp",
"HaloVmax",
"HaloSpin",
"SnapNum",
"LookBackTimeToSnap",
"CentralMvir",
"CentralRvir",
"DistanceToCentralGal",
"Pos",
"Vel",
"Len",
"Mvir",
"Rvir",
"Vvir",
"Vmax",
"ColdGasSpin",
"DiskSpin",
"InfallVmax",
"InfallVmaxPeak",
"InfallSnap",
"InfallHotGas",
"HotRadius",
"OriMergTime",
"MergTime",
"ColdGas",
"ColdGasRings",
"H2fraction",
"H2fractionRings",
"StellarMass",
"DiskMass",
"BulgeMass",
"DiskMassRings",
"BulgeMassRings",
"HotGas",
"EjectedMass",
"BlackHoleMass",
"ICM",
"MassFromInSitu",
"MassFromMergers",
"MassFromBursts",
"MetalsColdGas",
"MetalsColdGasRings",
"MetalsStellarMass",
"MetalsDiskMass",
"MetalsBulgeMass",
"MetalsDiskMassRings",
"MetalsBulgeMassRings",
"MetalsHotGas",
"MetalsEjectedMass",
"MetalsICM",
"DiskSNIIRate",
"BulgeSNIIRate",
"ICMSNIIRate",
"MassReturnRateToColdGas",
"MassReturnRateToHotGas",
"MetalsReturnRateToHotGas",
"PrimordialAccretionRate",
"CoolingRadius",
"ReheatingRate",
"MetalsReheatingRate",
"EjectionRate",
"CoolingRate",
"CoolingRate_beforeAGN",
"QuasarAccretionRate",
"RadioAccretionRate",
"Sfr",
"SfrInst",
"SfrRings",
"SfrInstRings",
"SfrBulge",
"XrayLum",
"BulgeSize",
"DiskRadius",
"ColdGasRadius",
"StellarHalfMassRadius",
"StellarHalfLightRadius",
"CosInclination",
"DisruptOn",
"MergeOn",
"MagDust",
"Mag",
"MagBulge",
"MassWeightAge",
"rbandWeightAge",
"sfh_ibin",
"sfh_numbins",
"sfh_DiskMass",
"sfh_BulgeMass",
"sfh_DiskMassRings",
"sfh_BulgeMassRings",
"sfh_ICM",
"sfh_MetalsDiskMass",
"sfh_MetalsBulgeMass",
"sfh_MetalsICM",
"sfh_DiskMass_elements",
"sfh_BulgeMass_elements",
"sfh_ICM_elements",
"DiskMass_elements",
"BulgeMass_elements",
"DiskMassRings_elements",
"BulgeMassRings_elements",
"ColdGas_elements",
"ColdGasRings_elements",
"HotGas_elements",
"ICM_elements",
"EjectedMass_elements",
};
 
// Information describing the datatypes and array flags
// that we will use to construct HDF5 field_types.
 
char types[]={
'i',
'i',
'f',
'f',
'f',
'f',
'f',
'f',
'f',
'f',
'i',
'f',
'f',
'f',
'f',
'f',
'f',
'i',
'f',
'f',
'f',
'f',
'f',
'f',
'f',
'f',
'i',
'f',
'f',
'f',
'f',
'f',
'f',
'f',
'f',
'f',
'f',
'f',
'f',
'f',
'f',
'f',
'f',
'f',
'f',
'f',
'f',
'f',
'f',
'f',
'f',
'f',
'f',
'f',
'f',
'f',
'f',
'f',
'f',
'f',
'f',
'f',
'f',
'f',
'f',
'f',
'f',
'f',
'f',
'f',
'f',
'f',
'f',
'f',
'f',
'f',
'f',
'f',
'f',
'f',
'f',
'f',
'f',
'f',
'i',
'i',
'f',
'f',
'f',
'f',
'f',
'i',
'i',
'f',
'f',
'f',
'f',
'f',
'f',
'f',
'f',
'f',
'f',
'f',
'f',
'f',
'f',
'f',
'f',
'f',
'f',
'f',
'f',
}; 
 
int flag3[]={
0,
0,
0,
0,
0,
1,
1,
0,
0,
1,
0,
0,
0,
0,
1,
1,
1,
0,
0,
0,
0,
0,
1,
1,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
}; 
 
int flagMag[]={
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
1,
1,
1,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
}; 
 
int flagRings[]={
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
1,
0,
1,
0,
0,
0,
1,
1,
0,
0,
0,
0,
0,
0,
0,
0,
1,
0,
0,
0,
1,
1,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
1,
1,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
1,
1,
0,
0,
0,
0,
0,
0,
0,
0,
0,
1,
1,
0,
1,
0,
0,
0,
}; 
 
int flagSFH[]={
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
1,
1,
1,
1,
1,
1,
1,
1,
1,
1,
1,
0,
0,
0,
0,
0,
0,
0,
0,
0,
}; 
 
int flagMetals[]={
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
1,
1,
1,
1,
1,
1,
1,
1,
1,
1,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
1,
1,
1,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
}; 
int flagElements[]={
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
0,
1,
1,
1,
1,
1,
1,
1,
1,
1,
1,
1,
1,
}; 
